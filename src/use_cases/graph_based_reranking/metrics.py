import pytrec_eval
import json
import torch
import numpy as np
import pandas as pd
from torch import nn

def mrr(truth, pred, N):
    """
    MRR
    """
    result = {}
    for k in truth.keys():
        qrels_list, run_list = [], []
        qrels_pos = 0.0
        result[k] = {'mrr': 0.0}
        candidates = truth[k]
        for dataset in candidates:
            qrels_list.append([dataset, candidates[dataset]])
        candidates = pred[k]
        for dataset in candidates:
            run_list.append([dataset, candidates[dataset]])
        qrels_list.sort(key=lambda x: x[1], reverse=True)
        run_list.sort(key=lambda x: x[1], reverse=True)
        if len(run_list) == 0:
            continue
        rr = 0.0
        run_keys = []
        for i in range(N):
            run_keys.append(run_list[i][0])
        for i in range(N):
            if run_keys[i] in truth[k] and truth[k][run_keys[i]] > 0:
                rr += 1 / (i + 1)
                break

        result[k]['mrr'] = rr
    return result


# qrels = {'L2_2': {'7142': 0, '12266': 1, '22178': 1, '42448': 0, '36656': 0, '12917': 0, '3504': 0, '19094': 0, '293': 0, '17597': 1, '33395': 0, '29538': 0, '23304': 0, '25264': 1, '37214': 0, '1621': 0, '43620': 0, '19315': 0, '44919': 0, '9906': 0, '14708': 0, '21036': 0, '10731': 0, '29929': 0, '10298': 0, '22132': 0, '8591': 0, '32902': 0, '41142': 0, '18875': 0, '18929': 0, '21661': 0, '35183': 0, '24748': 0, '27328': 0, '43111': 0, '23482': 1, '9929': 1, '22895': 0, '21678': 0, '14133': 0, '14034': 0, '251': 0, '36856': 0, '46477': 1, '34855': 0, '42812': 0, '1446': 0, '43837': 0, '39193': 0, '21971': 1, '43342': 0, '28036': 0, '27944': 1, '27892': 1, '14799': 0, '37196': 0, '12523': 0, '17345': 0, '36844': 0, '11689': 1}, 'L2_4': {'28034': 1, '45933': 0, '32561': 1, '46262': 0, '9975': 0, '997': 0, '3456': 0, '34924': 0, '39702': 0, '22825': 0, '34921': 0, '24237': 0, '35515': 0, '17313': 0, '42966': 0, '6274': 0, '3732': 0, '7839': 0, '1319': 0, '12572': 0, '41190': 0, '31144': 0, '41022': 0, '11940': 1, '35410': 0, '40241': 1, '40156': 0, '1773': 0, '40020': 0, '17063': 0, '32464': 0, '20753': 0, '6308': 0, '11855': 1, '10927': 1, '42755': 1, '24461': 0, '39081': 0, '12130': 0, '27936': 0, '10244': 1, '16962': 1, '37287': 1, '8784': 0, '29802': 0, '4645': 0, '34004': 0, '36939': 0, '6431': 1, '3418': 1, '33745': 0, '37119': 0, '11589': 0, '16845': 0, '19585': 0, '12545': 0, '14127': 0, '25411': 0, '45302': 0, '724': 0, '21413': 0, '43888': 0, '46137': 0, '3809': 0, '4512': 0}, 'L2_8': {'26083': 1, '11388': 0, '22347': 1, '9461': 1, '25119': 0, '44781': 0, '44620': 0, '43896': 1, '33928': 1, '3503': 0, '25727': 1, '43668': 1, '10600': 1, '3012': 1, '10426': 1, '39646': 1, '6550': 1, '41424': 0, '18585': 1, '9602': 0, '35691': 0, '18247': 0, '23027': 1, '36525': 1, '31132': 1, '18621': 0, '45501': 1, '728': 1, '12005': 1, '17629': 1, '19095': 0, '29373': 1, '25622': 1, '33813': 1, '32036': 1, '31865': 0, '12887': 1, '36192': 1, '10257': 1, '16921': 1, '10097': 0, '16969': 1, '22401': 0, '2368': 0, '42132': 0, '398': 1, '33789': 1, '34437': 0, '29244': 0, '46425': 0, '46383': 1, '46143': 1, '45419': 0, '16516': 1, '22358': 0, '3612': 1, '32744': 0, '19311': 1}, 'L2_12': {'20091': 0, '19835': 0, '37720': 0, '33656': 1, '13786': 0, '1677': 0, '24142': 0, '25431': 0, '34168': 0, '1529': 0, '24189': 0, '28753': 0, '13558': 0, '42793': 1, '28040': 0, '17153': 0, '22464': 0, '30243': 0, '42692': 1, '16849': 0, '35755': 0, '19752': 0, '41849': 0, '5465': 0, '20210': 0, '6765': 0, '46011': 0, '17936': 0, '20716': 0, '35581': 0, '38224': 1, '45454': 0, '20062': 1, '29641': 0, '22232': 1, '1716': 0, '45548': 0, '7484': 0, '28832': 0, '21687': 1, '1040': 0, '40179': 0, '11646': 0, '1898': 0, '38747': 0, '41138': 1, '21100': 0, '18020': 0, '6225': 0, '22488': 0, '5030': 0, '43266': 0}, 'L2_20': {'7464': 1, '41794': 1, '45133': 1, '14285': 1, '19677': 1, '22091': 1, '14840': 1, '6914': 1, '6412': 1, '26778': 1, '15607': 1, '26047': 0, '23564': 0, '25142': 0, '36363': 1, '38594': 1, '40179': 1, '32965': 1, '13451': 0, '17136': 1, '46168': 1, '2875': 1, '16778': 1, '35399': 1, '30727': 0, '7484': 0, '8002': 0, '31064': 1, '18923': 1, '30298': 1}, 'L2_22': {'24248': 1, '19429': 1, '2122': 1, '41935': 0, '8769': 1, '7059': 1, '31638': 0, '27253': 1, '20576': 0, '42806': 0, '19419': 1, '44114': 1, '36719': 0, '17894': 0, '30100': 1, '8121': 0, '30188': 0, '1463': 0, '30918': 0, '10071': 1, '17789': 1, '21813': 1, '35149': 1, '44458': 0, '7198': 1, '19426': 1, '25707': 0, '28423': 0, '4615': 0, '37226': 0, '28799': 1, '34308': 1, '1624': 1, '30173': 1, '10790': 1, '45740': 0, '34061': 0, '8182': 0}, 'L2_34': {'30172': 1, '7223': 1, '5737': 0, '32758': 1, '9243': 0, '42919': 0, '9210': 1, '7572': 0, '8832': 0, '42692': 0, '30014': 0, '33728': 0, '43080': 0, '8772': 1, '45543': 0, '17597': 0, '39667': 0, '1': 0, '23373': 0, '31491': 0, '30789': 1, '21037': 1, '13165': 0, '33445': 0, '13275': 0, '27621': 0, '24580': 0, '5317': 0, '11363': 0, '42920': 0, '8364': 0, '19012': 0, '8870': 0, '26591': 0, '17735': 0, '2929': 0, '22501': 0, '39659': 1, '35477': 0, '2323': 0, '1269': 0}, 'L2_42': {'30594': 1, '11481': 0, '43807': 0, '30472': 0, '36569': 0, '8002': 0, '11535': 0, '37909': 0, '32350': 0, '11819': 0, '521': 0, '35655': 0, '17070': 0, '31332': 0, '10365': 1, '35085': 1, '4583': 0, '36461': 0, '24931': 1, '9088': 1, '39934': 1, '18359': 1, '26955': 1, '14834': 1, '14210': 0, '27008': 0, '23694': 0, '29978': 0, '2231': 0, '34432': 0, '33626': 0, '14853': 0, '39693': 0, '7859': 0, '5030': 0, '35986': 0, '24460': 0, '43655': 0, '39905': 0, '18166': 0, '8894': 0, '11491': 0, '18372': 0, '5992': 0, '20416': 0, '23893': 0, '15492': 0, '24308': 0, '42041': 1, '27812': 0, '4101': 0}, 'L2_43': {'9071': 0, '16893': 0, '43015': 0, '18422': 0, '10597': 0, '23424': 0, '45387': 0, '20872': 0, '925': 0, '12704': 0, '9763': 0, '4519': 0, '27136': 0, '18322': 0, '37725': 0, '30564': 0, '5862': 0, '31548': 0, '8991': 0, '8358': 0, '2919': 0, '39264': 0, '8788': 0, '14055': 0, '41818': 0, '37901': 0, '18804': 0, '39187': 0, '7613': 0, '28040': 0, '40053': 0, '44681': 0, '24959': 0, '42521': 0}, 'L2_49': {'30594': 1, '11481': 1, '43807': 1, '30472': 1, '36569': 1, '8002': 1, '11535': 1, '37909': 1, '32350': 1, '11819': 1, '521': 1, '35655': 1, '17070': 1, '31332': 1, '4583': 0, '36461': 0, '12680': 0, '35085': 1, '10365': 1, '18649': 0, '23574': 0, '18813': 0, '18152': 0, '34421': 0, '7206': 0, '16823': 0, '21846': 0, '34221': 0, '39977': 0, '1966': 0, '39545': 0, '17333': 0, '31042': 0, '26339': 0, '38737': 0, '1382': 0, '37187': 0, '33266': 0, '18166': 0, '18372': 0, '14210': 0, '23893': 0, '35986': 0, '11491': 0, '29978': 0, '5992': 0, '39905': 0, '24460': 0, '10411': 0, '41239': 0, '32590': 0, '15492': 0, '7307': 0, '275': 0, '43383': 0, '35670': 0, '27812': 0, '24308': 0, '40962': 0, '25167': 0, '27974': 0, '6816': 0, '22319': 0}}
# run = {'L2_2': {'7142': 0.1963045299053192, '12266': 0.19646072387695312, '22178': 0.1963384449481964, '42448': 0.19683000445365906, '36656': 0.19666264951229095, '12917': 0.19632947444915771, '3504': 0.19645510613918304, '19094': 0.1964019238948822, '293': 0.19662362337112427, '17597': 0.1965126097202301, '33395': 0.19641730189323425, '29538': 0.1966984122991562, '23304': 0.19647333025932312, '25264': 0.19660742580890656, '37214': 0.19647720456123352, '1621': 0.1965763419866562, '43620': 0.1963987946510315, '19315': 0.19625836610794067, '44919': 0.19685783982276917, '9906': 0.1963905692100525, '14708': 0.19636045396327972, '21036': 0.19629710912704468, '10731': 0.19636280834674835, '29929': 0.1964409500360489, '10298': 0.19641876220703125, '22132': 0.19649697840213776, '8591': 0.19646812975406647, '32902': 0.1963726133108139, '41142': 0.19642987847328186, '18875': 0.19642116129398346, '18929': 0.1963942050933838, '21661': 0.1963261365890503, '35183': 0.19652031362056732, '24748': 0.1966744214296341, '27328': 0.19656583666801453, '43111': 0.1967698186635971, '23482': 0.1964205950498581, '9929': 0.1964147835969925, '22895': 0.19677092134952545, '21678': 0.19672445952892303, '14133': 0.19682280719280243, '14034': 0.1965816468000412, '251': 0.19631317257881165, '36856': 0.196442648768425, '46477': 0.1964738517999649, '34855': 0.19655156135559082, '42812': 0.1964268684387207, '1446': 0.1967359483242035, '43837': 0.196523055434227, '39193': 0.19642646610736847, '21971': 0.19666701555252075, '43342': 0.19660526514053345, '28036': 0.19650177657604218, '27944': 0.19641093909740448, '27892': 0.19635215401649475, '14799': 0.19654792547225952, '37196': 0.1964065134525299, '12523': 0.1965082585811615, '17345': 0.19656971096992493, '36844': 0.19659824669361115, '11689': 0.19628211855888367}, 'L2_4': {'28034': 0.19647741317749023, '45933': 0.19660602509975433, '32561': 0.19670513272285461, '46262': 0.19667701423168182, '9975': 0.19658763706684113, '997': 0.19655802845954895, '3456': 0.19645515084266663, '34924': 0.19650651514530182, '39702': 0.1962290108203888, '22825': 0.19645506143569946, '34921': 0.19665543735027313, '24237': 0.19695135951042175, '35515': 0.1966455727815628, '17313': 0.19654971361160278, '42966': 0.19687741994857788, '6274': 0.19687388837337494, '3732': 0.19664978981018066, '7839': 0.1965654194355011, '1319': 0.1966456174850464, '12572': 0.19647659361362457, '41190': 0.19655504822731018, '31144': 0.19657519459724426, '41022': 0.19647495448589325, '11940': 0.1965661644935608, '35410': 0.1964147984981537, '40241': 0.19652503728866577, '40156': 0.1965269297361374, '1773': 0.19651906192302704, '40020': 0.19648368656635284, '17063': 0.1963854730129242, '32464': 0.19668884575366974, '20753': 0.19599959254264832, '6308': 0.19600032269954681, '11855': 0.19616921246051788, '10927': 0.19628213346004486, '42755': 0.19639979302883148, '24461': 0.19689488410949707, '39081': 0.19600032269954681, '12130': 0.19600051641464233, '27936': 0.1965559720993042, '10244': 0.19650638103485107, '16962': 0.1967996507883072, '37287': 0.19624251127243042, '8784': 0.19599826633930206, '29802': 0.1965525895357132, '4645': 0.19650381803512573, '34004': 0.19650982320308685, '36939': 0.1964392513036728, '6431': 0.19667497277259827, '3418': 0.19641466438770294, '33745': 0.196369469165802, '37119': 0.1963719129562378, '11589': 0.19664527475833893, '16845': 0.1968757063150406, '19585': 0.1964625120162964, '12545': 0.19660787284374237, '14127': 0.19637298583984375, '25411': 0.1963847577571869, '45302': 0.19668543338775635, '724': 0.19692251086235046, '21413': 0.1964101642370224, '43888': 0.19689437747001648, '46137': 0.1965317726135254, '3809': 0.19645467400550842, '4512': 0.19691115617752075}, 'L2_8': {'26083': 0.19688677787780762, '11388': 0.196842223405838, '22347': 0.19681327044963837, '9461': 0.19671176373958588, '25119': 0.19666796922683716, '44781': 0.19683018326759338, '44620': 0.19682399928569794, '43896': 0.19678309559822083, '33928': 0.1966579556465149, '3503': 0.1968797743320465, '25727': 0.19676020741462708, '43668': 0.1968272626399994, '10600': 0.1967093050479889, '3012': 0.19677795469760895, '10426': 0.19675679504871368, '39646': 0.1966649740934372, '6550': 0.196844220161438, '41424': 0.19684214890003204, '18585': 0.19690431654453278, '9602': 0.19682107865810394, '35691': 0.19663113355636597, '18247': 0.1968270242214203, '23027': 0.1967046707868576, '36525': 0.19665324687957764, '31132': 0.19670377671718597, '18621': 0.1967352032661438, '45501': 0.19679664075374603, '728': 0.196566641330719, '12005': 0.19676636159420013, '17629': 0.19680379331111908, '19095': 0.19667625427246094, '29373': 0.19675906002521515, '25622': 0.19700545072555542, '33813': 0.1968572437763214, '32036': 0.19699594378471375, '31865': 0.19688917696475983, '12887': 0.19701839983463287, '36192': 0.1966954469680786, '10257': 0.19669373333454132, '16921': 0.19696460664272308, '10097': 0.19699101150035858, '16969': 0.1969098299741745, '22401': 0.19661332666873932, '2368': 0.19686558842658997, '42132': 0.19698986411094666, '398': 0.19684287905693054, '33789': 0.19680437445640564, '34437': 0.19703075289726257, '29244': 0.19658778607845306, '46425': 0.19660885632038116, '46383': 0.1966003030538559, '46143': 0.1967524290084839, '45419': 0.19666603207588196, '16516': 0.1965746283531189, '22358': 0.19688645005226135, '3612': 0.19660086929798126, '32744': 0.19671425223350525, '19311': 0.19677913188934326}, 'L2_12': {'20091': 0.19636604189872742, '19835': 0.19636867940425873, '37720': 0.19631609320640564, '33656': 0.19625334441661835, '13786': 0.19649867713451385, '1677': 0.19634680449962616, '24142': 0.1964951455593109, '25431': 0.19653622806072235, '34168': 0.19669556617736816, '1529': 0.19651684165000916, '24189': 0.19632001221179962, '28753': 0.19636118412017822, '13558': 0.19640029966831207, '42793': 0.19646687805652618, '28040': 0.19648686051368713, '17153': 0.19638821482658386, '22464': 0.19645226001739502, '30243': 0.19638364017009735, '42692': 0.19644811749458313, '16849': 0.19625772535800934, '35755': 0.1963554471731186, '19752': 0.1962127983570099, '41849': 0.19640330970287323, '5465': 0.19624678790569305, '20210': 0.19641919434070587, '6765': 0.19628457725048065, '46011': 0.1964290589094162, '17936': 0.1963799148797989, '20716': 0.19639483094215393, '35581': 0.1963834911584854, '38224': 0.1964004635810852, '45454': 0.19656667113304138, '20062': 0.1962628960609436, '29641': 0.19652046263217926, '22232': 0.19635005295276642, '1716': 0.19632992148399353, '45548': 0.19632993638515472, '7484': 0.19641675055027008, '28832': 0.19641751050949097, '21687': 0.19632531702518463, '1040': 0.19641625881195068, '40179': 0.19641762971878052, '11646': 0.19641762971878052, '1898': 0.19641456007957458, '38747': 0.1964149922132492, '41138': 0.19634617865085602, '21100': 0.19658423960208893, '18020': 0.19634410738945007, '6225': 0.19639967381954193, '22488': 0.1964392513036728, '5030': 0.19646474719047546, '43266': 0.19643177092075348}, 'L2_20': {'7464': 0.19627080857753754, '41794': 0.19627001881599426, '45133': 0.19627074897289276, '14285': 0.19626650214195251, '19677': 0.1962808072566986, '22091': 0.19627845287322998, '14840': 0.19626975059509277, '6914': 0.19626358151435852, '6412': 0.19626879692077637, '26778': 0.19626371562480927, '15607': 0.19626282155513763, '26047': 0.19628481566905975, '23564': 0.19634385406970978, '25142': 0.1962519884109497, '36363': 0.1962590515613556, '38594': 0.19632300734519958, '40179': 0.1963265985250473, '32965': 0.196326345205307, '13451': 0.19632300734519958, '17136': 0.1962321251630783, '46168': 0.1963222324848175, '2875': 0.1962735652923584, '16778': 0.1962590515613556, '35399': 0.1962510645389557, '30727': 0.19616220891475677, '7484': 0.19632573425769806, '8002': 0.19642922282218933, '31064': 0.19629067182540894, '18923': 0.1963721364736557, '30298': 0.19618463516235352}, 'L2_22': {'24248': 0.19698292016983032, '19429': 0.19690477848052979, '2122': 0.19698965549468994, '41935': 0.19690944254398346, '8769': 0.19696298241615295, '7059': 0.19681942462921143, '31638': 0.19684015214443207, '27253': 0.19689761102199554, '20576': 0.19669266045093536, '42806': 0.196912944316864, '19419': 0.19693130254745483, '44114': 0.1970236748456955, '36719': 0.19688387215137482, '17894': 0.19681863486766815, '30100': 0.1969594806432724, '8121': 0.19677411019802094, '30188': 0.19688723981380463, '1463': 0.19684110581874847, '30918': 0.1969318985939026, '10071': 0.19692648947238922, '17789': 0.19688889384269714, '21813': 0.1969837099313736, '35149': 0.1969178318977356, '44458': 0.19696037471294403, '7198': 0.19689661264419556, '19426': 0.19699078798294067, '25707': 0.1969861090183258, '28423': 0.19689467549324036, '4615': 0.1970217376947403, '37226': 0.19663608074188232, '28799': 0.1969454139471054, '34308': 0.19692765176296234, '1624': 0.19687172770500183, '30173': 0.1968483030796051, '10790': 0.1968594193458557, '45740': 0.19637390971183777, '34061': 0.1965857744216919, '8182': 0.19677412509918213}, 'L2_34': {'30172': 0.19634497165679932, '7223': 0.19634832441806793, '5737': 0.19634006917476654, '32758': 0.19633749127388, '9243': 0.1963305026292801, '42919': 0.19637955725193024, '9210': 0.1963135451078415, '7572': 0.19631735980510712, '8832': 0.19632190465927124, '42692': 0.19634579122066498, '30014': 0.19634346663951874, '33728': 0.1963428258895874, '43080': 0.19634512066841125, '8772': 0.1964011788368225, '45543': 0.19631755352020264, '17597': 0.19638721644878387, '39667': 0.19636695086956024, '1': 0.19634699821472168, '23373': 0.19636957347393036, '31491': 0.19635526835918427, '30789': 0.19633395969867706, '21037': 0.1963677555322647, '13165': 0.19636258482933044, '33445': 0.19636568427085876, '13275': 0.19635985791683197, '27621': 0.19635504484176636, '24580': 0.1963568478822708, '5317': 0.19632895290851593, '11363': 0.19633053243160248, '42920': 0.19633208215236664, '8364': 0.19637970626354218, '19012': 0.1963469684123993, '8870': 0.19634413719177246, '26591': 0.19633325934410095, '17735': 0.19633062183856964, '2929': 0.19632254540920258, '22501': 0.19629766047000885, '39659': 0.19642236828804016, '35477': 0.1963038146495819, '2323': 0.19630545377731323, '1269': 0.19629013538360596}, 'L2_42': {'30594': 0.19651857018470764, '11481': 0.19649013876914978, '43807': 0.19651912152767181, '30472': 0.19649526476860046, '36569': 0.19651739299297333, '8002': 0.19648566842079163, '11535': 0.19650600850582123, '37909': 0.1965164989233017, '32350': 0.19649672508239746, '11819': 0.1965164989233017, '521': 0.1964876800775528, '35655': 0.19650112092494965, '17070': 0.19651831686496735, '31332': 0.1965179145336151, '10365': 0.19640769064426422, '35085': 0.1964097023010254, '4583': 0.19649925827980042, '36461': 0.19637684524059296, '24931': 0.19640794396400452, '9088': 0.19640547037124634, '39934': 0.19640563428401947, '18359': 0.19641491770744324, '26955': 0.19641521573066711, '14834': 0.19641514122486115, '14210': 0.19647100567817688, '27008': 0.19646978378295898, '23694': 0.1964629590511322, '29978': 0.19646340608596802, '2231': 0.19658896327018738, '34432': 0.19641989469528198, '33626': 0.1963624358177185, '14853': 0.1965126097202301, '39693': 0.1963302493095398, '7859': 0.19636288285255432, '5030': 0.19642561674118042, '35986': 0.19631163775920868, '24460': 0.19620975852012634, '43655': 0.1962781548500061, '39905': 0.19640246033668518, '18166': 0.19637320935726166, '8894': 0.1963615119457245, '11491': 0.19657926261425018, '18372': 0.19656524062156677, '5992': 0.1963709592819214, '20416': 0.19636794924736023, '23893': 0.19644047319889069, '15492': 0.1964321881532669, '24308': 0.19642534852027893, '42041': 0.19629350304603577, '27812': 0.196355938911438, '4101': 0.196456179022789}, 'L2_43': {'9071': 0.19686470925807953, '16893': 0.19695019721984863, '43015': 0.19690677523612976, '18422': 0.19692504405975342, '10597': 0.19692252576351166, '23424': 0.19691114127635956, '45387': 0.19686824083328247, '20872': 0.19684742391109467, '925': 0.19689945876598358, '12704': 0.19687314331531525, '9763': 0.19685529172420502, '4519': 0.19680003821849823, '27136': 0.19689001142978668, '18322': 0.1968868374824524, '37725': 0.19688786566257477, '30564': 0.19689135253429413, '5862': 0.19691739976406097, '31548': 0.1969592422246933, '8991': 0.19689615070819855, '8358': 0.19692115485668182, '2919': 0.19685223698616028, '39264': 0.19682469964027405, '8788': 0.19699284434318542, '14055': 0.1968250721693039, '41818': 0.19682911038398743, '37901': 0.19710761308670044, '18804': 0.19709643721580505, '39187': 0.19702152907848358, '7613': 0.19699610769748688, '28040': 0.19708922505378723, '40053': 0.19699609279632568, '44681': 0.19721610844135284, '24959': 0.19720062613487244, '42521': 0.19721488654613495}, 'L2_49': {'30594': 0.1965695321559906, '11481': 0.19654054939746857, '43807': 0.19657008349895477, '30472': 0.19654573500156403, '36569': 0.1965682953596115, '8002': 0.19653593003749847, '11535': 0.1965566724538803, '37909': 0.19656741619110107, '32350': 0.1965472400188446, '11819': 0.19656741619110107, '521': 0.19653795659542084, '35655': 0.1965516209602356, '17070': 0.1965692639350891, '31332': 0.19656884670257568, '4583': 0.19654949009418488, '36461': 0.19642473757266998, '12680': 0.1965397596359253, '35085': 0.19645844399929047, '10365': 0.19645634293556213, '18649': 0.19640636444091797, '23574': 0.19643168151378632, '18813': 0.19643840193748474, '18152': 0.1964406967163086, '34421': 0.1963922530412674, '7206': 0.19636288285255432, '16823': 0.19636231660842896, '21846': 0.1964813619852066, '34221': 0.19654996693134308, '39977': 0.19642996788024902, '1966': 0.19648703932762146, '39545': 0.19643695652484894, '17333': 0.19639521837234497, '31042': 0.19649089872837067, '26339': 0.19660872220993042, '38737': 0.1966337412595749, '1382': 0.19651514291763306, '37187': 0.19664031267166138, '33266': 0.1965928077697754, '18166': 0.19642089307308197, '18372': 0.19661691784858704, '14210': 0.19652067124843597, '23893': 0.1964893937110901, '35986': 0.1963576227426529, '11491': 0.19663125276565552, '29978': 0.19651295244693756, '5992': 0.19641833007335663, '39905': 0.19645047187805176, '24460': 0.19625255465507507, '10411': 0.19653570652008057, '41239': 0.19659210741519928, '32590': 0.19658176600933075, '15492': 0.19648098945617676, '7307': 0.19658739864826202, '275': 0.19651862978935242, '43383': 0.19649800658226013, '35670': 0.19644629955291748, '27812': 0.19640293717384338, '24308': 0.19647398591041565, '40962': 0.19647715985774994, '25167': 0.19654850661754608, '27974': 0.19656416773796082, '6816': 0.19662414491176605, '22319': 0.1964874416589737}}
# run = {'L2_2': {'7142': 0.1963045299053192, '12266': -0.9646072387695312, '22178': 0.1963384449481964, '42448': 0.19683000445365906, '36656': 0.19666264951229095, '12917': 0.19632947444915771, '3504': 0.19645510613918304, '19094': 0.1964019238948822, '293': 0.19662362337112427, '17597': 0.1965126097202301, '33395': 0.19641730189323425, '29538': 0.1966984122991562, '23304': 0.19647333025932312, '25264': 0.19660742580890656, '37214': 0.19647720456123352, '1621': 0.1965763419866562, '43620': 0.1963987946510315, '19315': 0.19625836610794067, '44919': 0.19685783982276917, '9906': 0.1963905692100525, '14708': 0.19636045396327972, '21036': 0.19629710912704468, '10731': 0.19636280834674835, '29929': 0.1964409500360489, '10298': 0.19641876220703125, '22132': 0.19649697840213776, '8591': 0.19646812975406647, '32902': 0.1963726133108139, '41142': 0.19642987847328186, '18875': 0.19642116129398346, '18929': 0.1963942050933838, '21661': 0.1963261365890503, '35183': 0.19652031362056732, '24748': 0.1966744214296341, '27328': 0.19656583666801453, '43111': 0.1967698186635971, '23482': 0.1964205950498581, '9929': 0.1964147835969925, '22895': 0.19677092134952545, '21678': 0.19672445952892303, '14133': 0.19682280719280243, '14034': 0.1965816468000412, '251': 0.19631317257881165, '36856': 0.196442648768425, '46477': 0.1964738517999649, '34855': 0.19655156135559082, '42812': 0.1964268684387207, '1446': 0.1967359483242035, '43837': 0.196523055434227, '39193': 0.19642646610736847, '21971': 0.19666701555252075, '43342': 0.19660526514053345, '28036': 0.19650177657604218, '27944': 0.19641093909740448, '27892': 0.19635215401649475, '14799': 0.19654792547225952, '37196': 0.1964065134525299, '12523': 0.1965082585811615, '17345': 0.19656971096992493, '36844': 0.19659824669361115, '11689': 0.19628211855888367}, 'L2_4': {'28034': 0.19647741317749023, '45933': 0.19660602509975433, '32561': 0.19670513272285461, '46262': 0.19667701423168182, '9975': 0.19658763706684113, '997': 0.19655802845954895, '3456': 0.19645515084266663, '34924': 0.19650651514530182, '39702': 0.1962290108203888, '22825': 0.19645506143569946, '34921': 0.19665543735027313, '24237': 0.19695135951042175, '35515': 0.1966455727815628, '17313': 0.19654971361160278, '42966': 0.19687741994857788, '6274': 0.19687388837337494, '3732': 0.19664978981018066, '7839': 0.1965654194355011, '1319': 0.1966456174850464, '12572': 0.19647659361362457, '41190': 0.19655504822731018, '31144': 0.19657519459724426, '41022': 0.19647495448589325, '11940': 0.1965661644935608, '35410': 0.1964147984981537, '40241': 0.19652503728866577, '40156': 0.1965269297361374, '1773': 0.19651906192302704, '40020': 0.19648368656635284, '17063': 0.1963854730129242, '32464': 0.19668884575366974, '20753': 0.19599959254264832, '6308': 0.19600032269954681, '11855': 0.19616921246051788, '10927': 0.19628213346004486, '42755': 0.19639979302883148, '24461': 0.19689488410949707, '39081': 0.19600032269954681, '12130': 0.19600051641464233, '27936': 0.1965559720993042, '10244': 0.19650638103485107, '16962': 0.1967996507883072, '37287': 0.19624251127243042, '8784': 0.19599826633930206, '29802': 0.1965525895357132, '4645': 0.19650381803512573, '34004': 0.19650982320308685, '36939': 0.1964392513036728, '6431': 0.19667497277259827, '3418': 0.19641466438770294, '33745': 0.196369469165802, '37119': 0.1963719129562378, '11589': 0.19664527475833893, '16845': 0.1968757063150406, '19585': 0.1964625120162964, '12545': 0.19660787284374237, '14127': 0.19637298583984375, '25411': 0.1963847577571869, '45302': 0.19668543338775635, '724': 0.19692251086235046, '21413': 0.1964101642370224, '43888': 0.19689437747001648, '46137': 0.1965317726135254, '3809': 0.19645467400550842, '4512': 0.19691115617752075}, 'L2_8': {'26083': 0.19688677787780762, '11388': 0.196842223405838, '22347': 0.19681327044963837, '9461': 0.19671176373958588, '25119': 0.19666796922683716, '44781': 0.19683018326759338, '44620': 0.19682399928569794, '43896': 0.19678309559822083, '33928': 0.1966579556465149, '3503': 0.1968797743320465, '25727': 0.19676020741462708, '43668': 0.1968272626399994, '10600': 0.1967093050479889, '3012': 0.19677795469760895, '10426': 0.19675679504871368, '39646': 0.1966649740934372, '6550': 0.196844220161438, '41424': 0.19684214890003204, '18585': 0.19690431654453278, '9602': 0.19682107865810394, '35691': 0.19663113355636597, '18247': 0.1968270242214203, '23027': 0.1967046707868576, '36525': 0.19665324687957764, '31132': 0.19670377671718597, '18621': 0.1967352032661438, '45501': 0.19679664075374603, '728': 0.196566641330719, '12005': 0.19676636159420013, '17629': 0.19680379331111908, '19095': 0.19667625427246094, '29373': 0.19675906002521515, '25622': 0.19700545072555542, '33813': 0.1968572437763214, '32036': 0.19699594378471375, '31865': 0.19688917696475983, '12887': 0.19701839983463287, '36192': 0.1966954469680786, '10257': 0.19669373333454132, '16921': 0.19696460664272308, '10097': 0.19699101150035858, '16969': 0.1969098299741745, '22401': 0.19661332666873932, '2368': 0.19686558842658997, '42132': 0.19698986411094666, '398': 0.19684287905693054, '33789': 0.19680437445640564, '34437': 0.19703075289726257, '29244': 0.19658778607845306, '46425': 0.19660885632038116, '46383': 0.1966003030538559, '46143': 0.1967524290084839, '45419': 0.19666603207588196, '16516': 0.1965746283531189, '22358': 0.19688645005226135, '3612': 0.19660086929798126, '32744': 0.19671425223350525, '19311': 0.19677913188934326}, 'L2_12': {'20091': 0.19636604189872742, '19835': 0.19636867940425873, '37720': 0.19631609320640564, '33656': 0.19625334441661835, '13786': 0.19649867713451385, '1677': 0.19634680449962616, '24142': 0.1964951455593109, '25431': 0.19653622806072235, '34168': 0.19669556617736816, '1529': 0.19651684165000916, '24189': 0.19632001221179962, '28753': 0.19636118412017822, '13558': 0.19640029966831207, '42793': 0.19646687805652618, '28040': 0.19648686051368713, '17153': 0.19638821482658386, '22464': 0.19645226001739502, '30243': 0.19638364017009735, '42692': 0.19644811749458313, '16849': 0.19625772535800934, '35755': 0.1963554471731186, '19752': 0.1962127983570099, '41849': 0.19640330970287323, '5465': 0.19624678790569305, '20210': 0.19641919434070587, '6765': 0.19628457725048065, '46011': 0.1964290589094162, '17936': 0.1963799148797989, '20716': 0.19639483094215393, '35581': 0.1963834911584854, '38224': 0.1964004635810852, '45454': 0.19656667113304138, '20062': 0.1962628960609436, '29641': 0.19652046263217926, '22232': 0.19635005295276642, '1716': 0.19632992148399353, '45548': 0.19632993638515472, '7484': 0.19641675055027008, '28832': 0.19641751050949097, '21687': 0.19632531702518463, '1040': 0.19641625881195068, '40179': 0.19641762971878052, '11646': 0.19641762971878052, '1898': 0.19641456007957458, '38747': 0.1964149922132492, '41138': 0.19634617865085602, '21100': 0.19658423960208893, '18020': 0.19634410738945007, '6225': 0.19639967381954193, '22488': 0.1964392513036728, '5030': 0.19646474719047546, '43266': 0.19643177092075348}, 'L2_20': {'7464': 0.19627080857753754, '41794': 0.19627001881599426, '45133': 0.19627074897289276, '14285': 0.19626650214195251, '19677': 0.1962808072566986, '22091': 0.19627845287322998, '14840': 0.19626975059509277, '6914': 0.19626358151435852, '6412': 0.19626879692077637, '26778': 0.19626371562480927, '15607': 0.19626282155513763, '26047': 0.19628481566905975, '23564': 0.19634385406970978, '25142': 0.1962519884109497, '36363': 0.1962590515613556, '38594': 0.19632300734519958, '40179': 0.1963265985250473, '32965': 0.196326345205307, '13451': 0.19632300734519958, '17136': 0.1962321251630783, '46168': 0.1963222324848175, '2875': 0.1962735652923584, '16778': 0.1962590515613556, '35399': 0.1962510645389557, '30727': 0.19616220891475677, '7484': 0.19632573425769806, '8002': 0.19642922282218933, '31064': 0.19629067182540894, '18923': 0.1963721364736557, '30298': 0.19618463516235352}, 'L2_22': {'24248': 0.19698292016983032, '19429': 0.19690477848052979, '2122': 0.19698965549468994, '41935': 0.19690944254398346, '8769': 0.19696298241615295, '7059': 0.19681942462921143, '31638': 0.19684015214443207, '27253': 0.19689761102199554, '20576': 0.19669266045093536, '42806': 0.196912944316864, '19419': 0.19693130254745483, '44114': 0.1970236748456955, '36719': 0.19688387215137482, '17894': 0.19681863486766815, '30100': 0.1969594806432724, '8121': 0.19677411019802094, '30188': 0.19688723981380463, '1463': 0.19684110581874847, '30918': 0.1969318985939026, '10071': 0.19692648947238922, '17789': 0.19688889384269714, '21813': 0.1969837099313736, '35149': 0.1969178318977356, '44458': 0.19696037471294403, '7198': 0.19689661264419556, '19426': 0.19699078798294067, '25707': 0.1969861090183258, '28423': 0.19689467549324036, '4615': 0.1970217376947403, '37226': 0.19663608074188232, '28799': 0.1969454139471054, '34308': 0.19692765176296234, '1624': 0.19687172770500183, '30173': 0.1968483030796051, '10790': 0.1968594193458557, '45740': 0.19637390971183777, '34061': 0.1965857744216919, '8182': 0.19677412509918213}, 'L2_34': {'30172': 0.19634497165679932, '7223': 0.19634832441806793, '5737': 0.19634006917476654, '32758': 0.19633749127388, '9243': 0.1963305026292801, '42919': 0.19637955725193024, '9210': 0.1963135451078415, '7572': 0.19631735980510712, '8832': 0.19632190465927124, '42692': 0.19634579122066498, '30014': 0.19634346663951874, '33728': 0.1963428258895874, '43080': 0.19634512066841125, '8772': 0.1964011788368225, '45543': 0.19631755352020264, '17597': 0.19638721644878387, '39667': 0.19636695086956024, '1': 0.19634699821472168, '23373': 0.19636957347393036, '31491': 0.19635526835918427, '30789': 0.19633395969867706, '21037': 0.1963677555322647, '13165': 0.19636258482933044, '33445': 0.19636568427085876, '13275': 0.19635985791683197, '27621': 0.19635504484176636, '24580': 0.1963568478822708, '5317': 0.19632895290851593, '11363': 0.19633053243160248, '42920': 0.19633208215236664, '8364': 0.19637970626354218, '19012': 0.1963469684123993, '8870': 0.19634413719177246, '26591': 0.19633325934410095, '17735': 0.19633062183856964, '2929': 0.19632254540920258, '22501': 0.19629766047000885, '39659': 0.19642236828804016, '35477': 0.1963038146495819, '2323': 0.19630545377731323, '1269': 0.19629013538360596}, 'L2_42': {'30594': 0.19651857018470764, '11481': 0.19649013876914978, '43807': 0.19651912152767181, '30472': 0.19649526476860046, '36569': 0.19651739299297333, '8002': 0.19648566842079163, '11535': 0.19650600850582123, '37909': 0.1965164989233017, '32350': 0.19649672508239746, '11819': 0.1965164989233017, '521': 0.1964876800775528, '35655': 0.19650112092494965, '17070': 0.19651831686496735, '31332': 0.1965179145336151, '10365': 0.19640769064426422, '35085': 0.1964097023010254, '4583': 0.19649925827980042, '36461': 0.19637684524059296, '24931': 0.19640794396400452, '9088': 0.19640547037124634, '39934': 0.19640563428401947, '18359': 0.19641491770744324, '26955': 0.19641521573066711, '14834': 0.19641514122486115, '14210': 0.19647100567817688, '27008': 0.19646978378295898, '23694': 0.1964629590511322, '29978': 0.19646340608596802, '2231': 0.19658896327018738, '34432': 0.19641989469528198, '33626': 0.1963624358177185, '14853': 0.1965126097202301, '39693': 0.1963302493095398, '7859': 0.19636288285255432, '5030': 0.19642561674118042, '35986': 0.19631163775920868, '24460': 0.19620975852012634, '43655': 0.1962781548500061, '39905': 0.19640246033668518, '18166': 0.19637320935726166, '8894': 0.1963615119457245, '11491': 0.19657926261425018, '18372': 0.19656524062156677, '5992': 0.1963709592819214, '20416': 0.19636794924736023, '23893': 0.19644047319889069, '15492': 0.1964321881532669, '24308': 0.19642534852027893, '42041': 0.19629350304603577, '27812': 0.196355938911438, '4101': 0.196456179022789}, 'L2_43': {'9071': 0.19686470925807953, '16893': 0.19695019721984863, '43015': 0.19690677523612976, '18422': 0.19692504405975342, '10597': 0.19692252576351166, '23424': 0.19691114127635956, '45387': 0.19686824083328247, '20872': 0.19684742391109467, '925': 0.19689945876598358, '12704': 0.19687314331531525, '9763': 0.19685529172420502, '4519': 0.19680003821849823, '27136': 0.19689001142978668, '18322': 0.1968868374824524, '37725': 0.19688786566257477, '30564': 0.19689135253429413, '5862': 0.19691739976406097, '31548': 0.1969592422246933, '8991': 0.19689615070819855, '8358': 0.19692115485668182, '2919': 0.19685223698616028, '39264': 0.19682469964027405, '8788': 0.19699284434318542, '14055': 0.1968250721693039, '41818': 0.19682911038398743, '37901': 0.19710761308670044, '18804': 0.19709643721580505, '39187': 0.19702152907848358, '7613': 0.19699610769748688, '28040': 0.19708922505378723, '40053': 0.19699609279632568, '44681': 0.19721610844135284, '24959': 0.19720062613487244, '42521': 0.19721488654613495}, 'L2_49': {'30594': 0.1965695321559906, '11481': 0.19654054939746857, '43807': 0.19657008349895477, '30472': 0.19654573500156403, '36569': 0.1965682953596115, '8002': 0.19653593003749847, '11535': 0.1965566724538803, '37909': 0.19656741619110107, '32350': 0.1965472400188446, '11819': 0.19656741619110107, '521': 0.19653795659542084, '35655': 0.1965516209602356, '17070': 0.1965692639350891, '31332': 0.19656884670257568, '4583': 0.19654949009418488, '36461': 0.19642473757266998, '12680': 0.1965397596359253, '35085': 0.19645844399929047, '10365': 0.19645634293556213, '18649': 0.19640636444091797, '23574': 0.19643168151378632, '18813': 0.19643840193748474, '18152': 0.1964406967163086, '34421': 0.1963922530412674, '7206': 0.19636288285255432, '16823': 0.19636231660842896, '21846': 0.1964813619852066, '34221': 0.19654996693134308, '39977': 0.19642996788024902, '1966': 0.19648703932762146, '39545': 0.19643695652484894, '17333': 0.19639521837234497, '31042': 0.19649089872837067, '26339': 0.19660872220993042, '38737': 0.1966337412595749, '1382': 0.19651514291763306, '37187': 0.19664031267166138, '33266': 0.1965928077697754, '18166': 0.19642089307308197, '18372': 0.19661691784858704, '14210': 0.19652067124843597, '23893': 0.1964893937110901, '35986': 0.1963576227426529, '11491': 0.19663125276565552, '29978': 0.19651295244693756, '5992': 0.19641833007335663, '39905': 0.19645047187805176, '24460': 0.19625255465507507, '10411': 0.19653570652008057, '41239': 0.19659210741519928, '32590': 0.19658176600933075, '15492': 0.19648098945617676, '7307': 0.19658739864826202, '275': 0.19651862978935242, '43383': 0.19649800658226013, '35670': 0.19644629955291748, '27812': 0.19640293717384338, '24308': 0.19647398591041565, '40962': 0.19647715985774994, '25167': 0.19654850661754608, '27974': 0.19656416773796082, '6816': 0.19662414491176605, '22319': 0.1964874416589737}}
# run = {'L2_2': {'7142': -0.1963045299053192, '12266': 0.9646072387695312, '22178': -0.963384449481964, '42448': -0.19683000445365906, '36656': -0.19666264951229095, '12917': 0.19632947444915771, '3504': 0.19645510613918304, '19094': 0.1964019238948822, '293': 0.19662362337112427, '17597': 0.1965126097202301, '33395': 0.19641730189323425, '29538': 0.1966984122991562, '23304': 0.19647333025932312, '25264': 0.19660742580890656, '37214': 0.19647720456123352, '1621': 0.1965763419866562, '43620': 0.1963987946510315, '19315': 0.19625836610794067, '44919': 0.19685783982276917, '9906': 0.1963905692100525, '14708': 0.19636045396327972, '21036': 0.19629710912704468, '10731': 0.19636280834674835, '29929': 0.1964409500360489, '10298': 0.19641876220703125, '22132': 0.19649697840213776, '8591': 0.19646812975406647, '32902': 0.1963726133108139, '41142': 0.19642987847328186, '18875': 0.19642116129398346, '18929': 0.1963942050933838, '21661': 0.1963261365890503, '35183': 0.19652031362056732, '24748': 0.1966744214296341, '27328': 0.19656583666801453, '43111': 0.1967698186635971, '23482': 0.1964205950498581, '9929': 0.1964147835969925, '22895': 0.19677092134952545, '21678': 0.19672445952892303, '14133': 0.19682280719280243, '14034': 0.1965816468000412, '251': 0.19631317257881165, '36856': 0.196442648768425, '46477': 0.1964738517999649, '34855': 0.19655156135559082, '42812': 0.1964268684387207, '1446': 0.1967359483242035, '43837': 0.196523055434227, '39193': 0.19642646610736847, '21971': 0.19666701555252075, '43342': 0.19660526514053345, '28036': 0.19650177657604218, '27944': 0.19641093909740448, '27892': 0.19635215401649475, '14799': 0.19654792547225952, '37196': 0.1964065134525299, '12523': 0.1965082585811615, '17345': 0.19656971096992493, '36844': 0.19659824669361115, '11689': 0.19628211855888367}, 'L2_4': {'28034': 0.19647741317749023, '45933': 0.19660602509975433, '32561': 0.19670513272285461, '46262': 0.19667701423168182, '9975': 0.19658763706684113, '997': 0.19655802845954895, '3456': 0.19645515084266663, '34924': 0.19650651514530182, '39702': 0.1962290108203888, '22825': 0.19645506143569946, '34921': 0.19665543735027313, '24237': 0.19695135951042175, '35515': 0.1966455727815628, '17313': 0.19654971361160278, '42966': 0.19687741994857788, '6274': 0.19687388837337494, '3732': 0.19664978981018066, '7839': 0.1965654194355011, '1319': 0.1966456174850464, '12572': 0.19647659361362457, '41190': 0.19655504822731018, '31144': 0.19657519459724426, '41022': 0.19647495448589325, '11940': 0.1965661644935608, '35410': 0.1964147984981537, '40241': 0.19652503728866577, '40156': 0.1965269297361374, '1773': 0.19651906192302704, '40020': 0.19648368656635284, '17063': 0.1963854730129242, '32464': 0.19668884575366974, '20753': 0.19599959254264832, '6308': 0.19600032269954681, '11855': 0.19616921246051788, '10927': 0.19628213346004486, '42755': 0.19639979302883148, '24461': 0.19689488410949707, '39081': 0.19600032269954681, '12130': 0.19600051641464233, '27936': 0.1965559720993042, '10244': 0.19650638103485107, '16962': 0.1967996507883072, '37287': 0.19624251127243042, '8784': 0.19599826633930206, '29802': 0.1965525895357132, '4645': 0.19650381803512573, '34004': 0.19650982320308685, '36939': 0.1964392513036728, '6431': 0.19667497277259827, '3418': 0.19641466438770294, '33745': 0.196369469165802, '37119': 0.1963719129562378, '11589': 0.19664527475833893, '16845': 0.1968757063150406, '19585': 0.1964625120162964, '12545': 0.19660787284374237, '14127': 0.19637298583984375, '25411': 0.1963847577571869, '45302': 0.19668543338775635, '724': 0.19692251086235046, '21413': 0.1964101642370224, '43888': 0.19689437747001648, '46137': 0.1965317726135254, '3809': 0.19645467400550842, '4512': 0.19691115617752075}, 'L2_8': {'26083': 0.19688677787780762, '11388': 0.196842223405838, '22347': 0.19681327044963837, '9461': 0.19671176373958588, '25119': 0.19666796922683716, '44781': 0.19683018326759338, '44620': 0.19682399928569794, '43896': 0.19678309559822083, '33928': 0.1966579556465149, '3503': 0.1968797743320465, '25727': 0.19676020741462708, '43668': 0.1968272626399994, '10600': 0.1967093050479889, '3012': 0.19677795469760895, '10426': 0.19675679504871368, '39646': 0.1966649740934372, '6550': 0.196844220161438, '41424': 0.19684214890003204, '18585': 0.19690431654453278, '9602': 0.19682107865810394, '35691': 0.19663113355636597, '18247': 0.1968270242214203, '23027': 0.1967046707868576, '36525': 0.19665324687957764, '31132': 0.19670377671718597, '18621': 0.1967352032661438, '45501': 0.19679664075374603, '728': 0.196566641330719, '12005': 0.19676636159420013, '17629': 0.19680379331111908, '19095': 0.19667625427246094, '29373': 0.19675906002521515, '25622': 0.19700545072555542, '33813': 0.1968572437763214, '32036': 0.19699594378471375, '31865': 0.19688917696475983, '12887': 0.19701839983463287, '36192': 0.1966954469680786, '10257': 0.19669373333454132, '16921': 0.19696460664272308, '10097': 0.19699101150035858, '16969': 0.1969098299741745, '22401': 0.19661332666873932, '2368': 0.19686558842658997, '42132': 0.19698986411094666, '398': 0.19684287905693054, '33789': 0.19680437445640564, '34437': 0.19703075289726257, '29244': 0.19658778607845306, '46425': 0.19660885632038116, '46383': 0.1966003030538559, '46143': 0.1967524290084839, '45419': 0.19666603207588196, '16516': 0.1965746283531189, '22358': 0.19688645005226135, '3612': 0.19660086929798126, '32744': 0.19671425223350525, '19311': 0.19677913188934326}, 'L2_12': {'20091': 0.19636604189872742, '19835': 0.19636867940425873, '37720': 0.19631609320640564, '33656': 0.19625334441661835, '13786': 0.19649867713451385, '1677': 0.19634680449962616, '24142': 0.1964951455593109, '25431': 0.19653622806072235, '34168': 0.19669556617736816, '1529': 0.19651684165000916, '24189': 0.19632001221179962, '28753': 0.19636118412017822, '13558': 0.19640029966831207, '42793': 0.19646687805652618, '28040': 0.19648686051368713, '17153': 0.19638821482658386, '22464': 0.19645226001739502, '30243': 0.19638364017009735, '42692': 0.19644811749458313, '16849': 0.19625772535800934, '35755': 0.1963554471731186, '19752': 0.1962127983570099, '41849': 0.19640330970287323, '5465': 0.19624678790569305, '20210': 0.19641919434070587, '6765': 0.19628457725048065, '46011': 0.1964290589094162, '17936': 0.1963799148797989, '20716': 0.19639483094215393, '35581': 0.1963834911584854, '38224': 0.1964004635810852, '45454': 0.19656667113304138, '20062': 0.1962628960609436, '29641': 0.19652046263217926, '22232': 0.19635005295276642, '1716': 0.19632992148399353, '45548': 0.19632993638515472, '7484': 0.19641675055027008, '28832': 0.19641751050949097, '21687': 0.19632531702518463, '1040': 0.19641625881195068, '40179': 0.19641762971878052, '11646': 0.19641762971878052, '1898': 0.19641456007957458, '38747': 0.1964149922132492, '41138': 0.19634617865085602, '21100': 0.19658423960208893, '18020': 0.19634410738945007, '6225': 0.19639967381954193, '22488': 0.1964392513036728, '5030': 0.19646474719047546, '43266': 0.19643177092075348}, 'L2_20': {'7464': 0.19627080857753754, '41794': 0.19627001881599426, '45133': 0.19627074897289276, '14285': 0.19626650214195251, '19677': 0.1962808072566986, '22091': 0.19627845287322998, '14840': 0.19626975059509277, '6914': 0.19626358151435852, '6412': 0.19626879692077637, '26778': 0.19626371562480927, '15607': 0.19626282155513763, '26047': 0.19628481566905975, '23564': 0.19634385406970978, '25142': 0.1962519884109497, '36363': 0.1962590515613556, '38594': 0.19632300734519958, '40179': 0.1963265985250473, '32965': 0.196326345205307, '13451': 0.19632300734519958, '17136': 0.1962321251630783, '46168': 0.1963222324848175, '2875': 0.1962735652923584, '16778': 0.1962590515613556, '35399': 0.1962510645389557, '30727': 0.19616220891475677, '7484': 0.19632573425769806, '8002': 0.19642922282218933, '31064': 0.19629067182540894, '18923': 0.1963721364736557, '30298': 0.19618463516235352}, 'L2_22': {'24248': 0.19698292016983032, '19429': 0.19690477848052979, '2122': 0.19698965549468994, '41935': 0.19690944254398346, '8769': 0.19696298241615295, '7059': 0.19681942462921143, '31638': 0.19684015214443207, '27253': 0.19689761102199554, '20576': 0.19669266045093536, '42806': 0.196912944316864, '19419': 0.19693130254745483, '44114': 0.1970236748456955, '36719': 0.19688387215137482, '17894': 0.19681863486766815, '30100': 0.1969594806432724, '8121': 0.19677411019802094, '30188': 0.19688723981380463, '1463': 0.19684110581874847, '30918': 0.1969318985939026, '10071': 0.19692648947238922, '17789': 0.19688889384269714, '21813': 0.1969837099313736, '35149': 0.1969178318977356, '44458': 0.19696037471294403, '7198': 0.19689661264419556, '19426': 0.19699078798294067, '25707': 0.1969861090183258, '28423': 0.19689467549324036, '4615': 0.1970217376947403, '37226': 0.19663608074188232, '28799': 0.1969454139471054, '34308': 0.19692765176296234, '1624': 0.19687172770500183, '30173': 0.1968483030796051, '10790': 0.1968594193458557, '45740': 0.19637390971183777, '34061': 0.1965857744216919, '8182': 0.19677412509918213}, 'L2_34': {'30172': 0.19634497165679932, '7223': 0.19634832441806793, '5737': 0.19634006917476654, '32758': 0.19633749127388, '9243': 0.1963305026292801, '42919': 0.19637955725193024, '9210': 0.1963135451078415, '7572': 0.19631735980510712, '8832': 0.19632190465927124, '42692': 0.19634579122066498, '30014': 0.19634346663951874, '33728': 0.1963428258895874, '43080': 0.19634512066841125, '8772': 0.1964011788368225, '45543': 0.19631755352020264, '17597': 0.19638721644878387, '39667': 0.19636695086956024, '1': 0.19634699821472168, '23373': 0.19636957347393036, '31491': 0.19635526835918427, '30789': 0.19633395969867706, '21037': 0.1963677555322647, '13165': 0.19636258482933044, '33445': 0.19636568427085876, '13275': 0.19635985791683197, '27621': 0.19635504484176636, '24580': 0.1963568478822708, '5317': 0.19632895290851593, '11363': 0.19633053243160248, '42920': 0.19633208215236664, '8364': 0.19637970626354218, '19012': 0.1963469684123993, '8870': 0.19634413719177246, '26591': 0.19633325934410095, '17735': 0.19633062183856964, '2929': 0.19632254540920258, '22501': 0.19629766047000885, '39659': 0.19642236828804016, '35477': 0.1963038146495819, '2323': 0.19630545377731323, '1269': 0.19629013538360596}, 'L2_42': {'30594': 0.19651857018470764, '11481': 0.19649013876914978, '43807': 0.19651912152767181, '30472': 0.19649526476860046, '36569': 0.19651739299297333, '8002': 0.19648566842079163, '11535': 0.19650600850582123, '37909': 0.1965164989233017, '32350': 0.19649672508239746, '11819': 0.1965164989233017, '521': 0.1964876800775528, '35655': 0.19650112092494965, '17070': 0.19651831686496735, '31332': 0.1965179145336151, '10365': 0.19640769064426422, '35085': 0.1964097023010254, '4583': 0.19649925827980042, '36461': 0.19637684524059296, '24931': 0.19640794396400452, '9088': 0.19640547037124634, '39934': 0.19640563428401947, '18359': 0.19641491770744324, '26955': 0.19641521573066711, '14834': 0.19641514122486115, '14210': 0.19647100567817688, '27008': 0.19646978378295898, '23694': 0.1964629590511322, '29978': 0.19646340608596802, '2231': 0.19658896327018738, '34432': 0.19641989469528198, '33626': 0.1963624358177185, '14853': 0.1965126097202301, '39693': 0.1963302493095398, '7859': 0.19636288285255432, '5030': 0.19642561674118042, '35986': 0.19631163775920868, '24460': 0.19620975852012634, '43655': 0.1962781548500061, '39905': 0.19640246033668518, '18166': 0.19637320935726166, '8894': 0.1963615119457245, '11491': 0.19657926261425018, '18372': 0.19656524062156677, '5992': 0.1963709592819214, '20416': 0.19636794924736023, '23893': 0.19644047319889069, '15492': 0.1964321881532669, '24308': 0.19642534852027893, '42041': 0.19629350304603577, '27812': 0.196355938911438, '4101': 0.196456179022789}, 'L2_43': {'9071': 0.19686470925807953, '16893': 0.19695019721984863, '43015': 0.19690677523612976, '18422': 0.19692504405975342, '10597': 0.19692252576351166, '23424': 0.19691114127635956, '45387': 0.19686824083328247, '20872': 0.19684742391109467, '925': 0.19689945876598358, '12704': 0.19687314331531525, '9763': 0.19685529172420502, '4519': 0.19680003821849823, '27136': 0.19689001142978668, '18322': 0.1968868374824524, '37725': 0.19688786566257477, '30564': 0.19689135253429413, '5862': 0.19691739976406097, '31548': 0.1969592422246933, '8991': 0.19689615070819855, '8358': 0.19692115485668182, '2919': 0.19685223698616028, '39264': 0.19682469964027405, '8788': 0.19699284434318542, '14055': 0.1968250721693039, '41818': 0.19682911038398743, '37901': 0.19710761308670044, '18804': 0.19709643721580505, '39187': 0.19702152907848358, '7613': 0.19699610769748688, '28040': 0.19708922505378723, '40053': 0.19699609279632568, '44681': 0.19721610844135284, '24959': 0.19720062613487244, '42521': 0.19721488654613495}, 'L2_49': {'30594': 0.1965695321559906, '11481': 0.19654054939746857, '43807': 0.19657008349895477, '30472': 0.19654573500156403, '36569': 0.1965682953596115, '8002': 0.19653593003749847, '11535': 0.1965566724538803, '37909': 0.19656741619110107, '32350': 0.1965472400188446, '11819': 0.19656741619110107, '521': 0.19653795659542084, '35655': 0.1965516209602356, '17070': 0.1965692639350891, '31332': 0.19656884670257568, '4583': 0.19654949009418488, '36461': 0.19642473757266998, '12680': 0.1965397596359253, '35085': 0.19645844399929047, '10365': 0.19645634293556213, '18649': 0.19640636444091797, '23574': 0.19643168151378632, '18813': 0.19643840193748474, '18152': 0.1964406967163086, '34421': 0.1963922530412674, '7206': 0.19636288285255432, '16823': 0.19636231660842896, '21846': 0.1964813619852066, '34221': 0.19654996693134308, '39977': 0.19642996788024902, '1966': 0.19648703932762146, '39545': 0.19643695652484894, '17333': 0.19639521837234497, '31042': 0.19649089872837067, '26339': 0.19660872220993042, '38737': 0.1966337412595749, '1382': 0.19651514291763306, '37187': 0.19664031267166138, '33266': 0.1965928077697754, '18166': 0.19642089307308197, '18372': 0.19661691784858704, '14210': 0.19652067124843597, '23893': 0.1964893937110901, '35986': 0.1963576227426529, '11491': 0.19663125276565552, '29978': 0.19651295244693756, '5992': 0.19641833007335663, '39905': 0.19645047187805176, '24460': 0.19625255465507507, '10411': 0.19653570652008057, '41239': 0.19659210741519928, '32590': 0.19658176600933075, '15492': 0.19648098945617676, '7307': 0.19658739864826202, '275': 0.19651862978935242, '43383': 0.19649800658226013, '35670': 0.19644629955291748, '27812': 0.19640293717384338, '24308': 0.19647398591041565, '40962': 0.19647715985774994, '25167': 0.19654850661754608, '27974': 0.19656416773796082, '6816': 0.19662414491176605, '22319': 0.1964874416589737}}
# #
with open('../data/ntcir/test.json') as f:
    qrels = json.load(f)

metrics = ['map_cut_5', 'ndcg_cut_5', 'P_5', 'recall_5', 'map_cut_10', 'ndcg_cut_10', 'P_10', 'recall_10',]
evaluator = pytrec_eval.RelevanceEvaluator(
    qrels, {'map_cut_5', 'ndcg_cut_5', 'P_5', 'recall_5', 'map_cut_10', 'ndcg_cut_10', 'P_10', 'recall_10', })
# # # evaluator = pytrec_eval.RelevanceEvaluator(
# # #     qrels, {'map_cut_5', 'ndcg_cut_5'})
# # # help(pytrec_eval.RelevanceEvaluator)
repeat = [i for i in range(7, 12)]
result2 = {}
for m in metrics:
    result2[m] = torch.zeros(len(repeat))

for i in range(len(repeat)):
    with open('../data/ntcir/test.json') as f:
        qrels = json.load(f)
    evaluator = pytrec_eval.RelevanceEvaluator(
        qrels, {'map_cut_5', 'ndcg_cut_5', 'P_5', 'recall_5', 'map_cut_10', 'ndcg_cut_10', 'P_10', 'recall_10', })
    # filename = f'../data/ntcir_metadata_content/bm25.json'
    filename = f'result/HINormer/run_ntcir_bm25_1_1_80_1e-05_10_1_{repeat[i]}.json'
    # filename = f'result/HINormer/run_ntcir_tfidf_3_5_40_0.0001_20_128_{i}.json'
    # filename = f'result/HINormer/run_ntcir_metadata_tfidf_1_1_40_1e-05_10_2_{repeat[i]}.json'
    print(filename)
    with open(filename, 'r') as f:
        run = json.load(f)
    # new_run = {}
    # for k in run.keys():
    #     candidates = run[k]
    #     new_run[k] = {}
    #     for dataset in candidates:
    #         if dataset == 'DATASET_00000000':
    #             dataset_node = '0'
    #         else:
    #             dataset_node = dataset.lstrip('DATASET_0')
    #         new_run[k][dataset_node] = candidates[dataset]
    result = evaluator.evaluate(run)
    # print(result)
    result_hr = mrr(qrels, run, 5)
    # for x in result:
    #     result[x]['mrr@5'] = result_hr[x]['mrr']
    # result_hr = mrr(qrels, new_run, 10)
    # for x in result:
    #     result[x]['mrr@10'] = result_hr[x]['mrr']
    results = {}
    # print(result)
    for metric in metrics:
        # print(x)
        results[metric] = sum([x[metric] for x in result.values()]) / len(result)
    print(results)
    for m in metrics:
        result2[m][i] = results[m]
for metric in metrics:
    print(f"{metric}: {result2[metric].mean().item():.4f}  std: {result2[metric].std().item():.4f}", )
#
import scipy.stats as stats
repeat1 = repeat
metrics = ['map_cut_5', 'ndcg_cut_5', 'P_5', 'recall_5', 'map_cut_10', 'ndcg_cut_10', 'P_10', 'recall_10']
repeat = [0, 1, 3, 12, 13]
result1 = {}
for m in metrics:
    result1[m] = torch.zeros(len(repeat))
result2 = {}
for m in metrics:
    result2[m] = torch.zeros(len(repeat))


def calculate_result(test_file, filename):
    result1 = {}
    for m in metrics:
        result1[m] = torch.zeros(repeat)
    with open(test_file) as f:
        qrels = json.load(f)
    evaluator = pytrec_eval.RelevanceEvaluator(
        qrels, {'map_cut_5', 'ndcg_cut_5', 'P_5', 'recall_5', 'map_cut_10', 'ndcg_cut_10', 'P_10', 'recall_10', })
    with open(filename, 'r') as f:
        run = json.load(f)
    new_run = {}
    for k in run.keys():
        candidates = run[k]
        new_run[k] = {}
        for dataset in candidates:
            if dataset == 'DATASET_00000000':
                dataset_node = '0'
            else:
                dataset_node = dataset.lstrip('DATASET_0')
            new_run[k][dataset_node] = candidates[dataset]
    result = evaluator.evaluate(new_run)
    results = {}
    # print(result)
    for metric in metrics:
        # print(x)
        results[metric] = sum([x[metric] for x in result.values()]) / len(result)
    print(results)
    # for m in metrics:
    #     result1[m][number] = results[m]
    return results


bge_result = results
print(bge_result)
for i in range(len(repeat)):
    # filename = f'result/run_FAERY_3_1_10_5e-05_128_qc_{i+4}.json'
    filename = f"result/HINormer/run_ntcir_metadata_tfidf_1_1_40_1e-05_10_1_{repeat1[i]}.json"
    # filename = '../data/ntcir/tfidf.json'
    results = calculate_result('../data/ntcir/test.json', filename)
    # with open(filename, 'r') as f:
    #     results = json.load(f)
    for m in metrics:
        result1[m][i] = results[m]
    # filename = f'../hinormer_modified/result/simpleHGN/result_Datafinder_4_0.0005_512_qc_{i}.json'
    # filename = f'result/run_DSEBench_3_1_10_5e-05_128_10_5_tq_{i}.json'
    # filename = f"result/run_Datafinder_3_3_10_0.0001_128_qc_{i}.json"
    filename = f'result/HINormer/run_ntcir_metadata_content_stella_tfidf_1_1_80_1e-05_10_1_{repeat[i]}.json'
    results = calculate_result('../data/ntcir/test.json', filename)
    # with open(filename, 'r') as f:
    #     results = json.load(f)
    #     # print(filename)
    #     # print(results.keys())
    for m in metrics:
        result2[m][i] = results[m]
for m in metrics:
    print(m)
    print(result1[m], result2[m])
    t_stat, p_value = stats.ttest_ind(result1[m], result2[m])

    print(f"t: {t_stat}")
    print(f"P: {p_value}")
    print("=="*10)
# #
# #
# for metric in metrics:
#     print(f"Ours: {metric}: {result1[metric].mean().item():.4f}, std: {result1[metric].std().item():.4f}", )
# #
# for metric in metrics:
#     print(f"Result2: {metric}: {result2[metric].mean().item():.4f}, std: {result2[metric].std().item():.4f}", )


# with open("../data/Datafinder/test.json", 'r') as f:
#     test_data = json.load(f)
#
# with open("../data/Datafinder/bm25_test.json", 'r') as f:
#     bm25_data = json.load(f)
#
# for k, v in bm25_data.items():
#     for did in v.keys():
#         if did in test_data[k]:
#             print(k)


# # avg_targets, num = 0, 0
# nums = [0]*15
# with open('../data/Datafinder/pairs.json', 'r') as f:
#     data = json.load(f)
# # with open('../data/Datafinder/train.json', 'r') as f:
# #     train_data = json.load(f)
# #
# multi_pairs = [[], [], [], [], []]
# for d in data:
#     # if d in train_data:
#         # avg_targets += len(data[d]['contexts'])
#     nums[len(data[d]['targets'])] += 1
# print(nums)
# multi_res = [{}, {}, {}, {}, {}]
# for d in data:
#     if len(data[d]['targets']) <= 4:
#         multi_pairs[len(data[d]['targets'])-1].append(d)
#     else:
#         multi_pairs[4].append(d)
#
# repeat = 5
# result1 = {}
# for m in metrics:
#     result1[m] = torch.zeros(repeat)
#
# for i in range(repeat):
#     with open('../data/Datafinder/test.json', 'r') as f:
#         qrels = json.load(f)
#     evaluator = pytrec_eval.RelevanceEvaluator(
#         qrels, {'map_cut_5', 'ndcg_cut_5', 'P_5', 'recall_5', 'map_cut_10', 'ndcg_cut_10', 'P_10', 'recall_10', })
#     filename = f'result/run_Datafinder_3_3_10_0.0001_128_qc_{i}.json'
#     with open(filename, 'r') as f:
#         runs = json.load(f)
#     new_runs = {}
#     for run in runs:
#         if run in multi_pairs[0]:
#             new_runs[run] = runs[run]
#     print(new_runs.keys())
#     result = evaluator.evaluate(new_runs)
#     results = {}
#     # print(result)
#     for metric in metrics:
#         # print(x)
#         results[metric] = sum([x[metric] for x in result.values()]) / len(result)
#     for m in metrics:
#         result1[m][i] = results[m]
#
# print(result1)
# for metric in metrics:
#     print(f"{metric}: {result1[metric].mean().item():.4f}  std: {result1[metric].std().item():.4f}", )
#
# print(avg_targets/len(data))
